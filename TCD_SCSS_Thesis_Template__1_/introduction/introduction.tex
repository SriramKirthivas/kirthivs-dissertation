\chapter{Introduction - Chapter}

\section{Section}

\subsection{Subsection}

\subsubsection{SSH}

SSH \cite{rfc4253} : \\
SSH -> transport layer -> secure, low-level transport protocol. \\
Provides strong encryption, crypto based host authentication and integrity protection. \\
Authentication -> host-based authentication. This does not perform user authentication. \\
Simple and flexible -> to allow parameter negotiation and to minimize number of round trips. 
Key exchange method, public key algo, symmetric encryption and others are negotiated. \\
Most env -> 2 round-trips needed for full key exchange, server authentication, service request and accept. 
Worst case - 3 round trips.

\paragraph{Connection setup :}

Works over any clean 8-bit binary-transparent transport. 
Transport should protect ssh connections against transmission errors. Client Initiates.

tcp/ip - listens to port 22(ssh). \\
After connection establishment - client and server must send an identification string.

\subparagraph{Identification string :}

SSH-protoversion-softwareversion SP comments CR LF

Protoversion - 2.0, comments - optional, if comments is used, SP should be used to separate softwareversion and comments. 
Identification - terminated by a single Carriage Return(CR) and single Line Feed(LF). 
NULL characters must not be sent. Max length - 255 characters including CR and LF.

Server - may send other lines of data before sending version string. 
Each line should be terminated by a CR and LF. 
Such lines should not begin with SSH- and should be encoded in ISO-10646 UTF-8. 
Client must be able to process such lines. 
If they are displayed, control character filtering should be used. 
Primary use is to allow TCP-Wrappers to display error message before disconnecting.

Protoversion and softwareversion - consist of printable US-ASCII characters, with exception of whitespace and minus sign.
Softwareversion - used to trigger compatibility extensions and to indicate capabilities of implementation. \\
Example : SSH-2.0-billsSSH\_3.6.3q3\textbackslash CR\textbackslash LF \\
Key exchange will begin immediately after sending this. 
All packets will use the binary packet protocol.

\subsubsection{TLS}

TLS \cite{rfc8446} \\
Transport Layer Security Protocol - primary goal - provide secure channel b/w 2 communicating peers. 
Only req - reliable, in-order data stream.

Properties of secure channel : \\
Authentication - server side always authenticated, client side optional. 
Authentication - via asymmetric crypto like RSA, Elliptic Curve Digital Signature Algo (ECDSA) or 
Edwards-Curve Digital Signature Algo (EdDSA) or symmetric pre-shared key (PSK). \\
Confidentiality - Data sent over the channel is only visible to endpoints. 
TLS does not hide the length of data it transmits, though endpoints may pad TLS records. \\
Integrity - Data sent cannot be modified by attackers without detection.

TLS has 2 primary components: \\
Handshake protocol - authenticates communicating parties, negotiates crypto modes and parameters, 
establishes shared keying material. Resists tampering by attackers. \\
Record protocol - uses parameters established by handshake to protect traffic. 
Divides traffic into records independently protected with keys.

TLS - application protocol independent. 
Does not specify how protocols add security with TLS, how to initiate handshaking or interpret certificates. 
Left to protocol designers running on top of TLS.

\subsubsection{SMTP}

SMTP \cite{rfc5321} \\
Objective - transfer mail reliably and efficiently. \\
SMTP - independent of transmission subsystem and requires only reliable ordered data stream channel. \\
Important feature - capability to transport mail across multiple networks, referred to as “SMTP mail relaying”.

Network examples: mutually-TCP-accessible hosts on public Internet, TCP/IP Intranet, LAN, WAN.

A process can transfer mail to another using relay or gateway processes. 
There can be multiple intermediate relay hosts.

SMTP client with a message establishes a two-way channel to an SMTP server. 
SMTP is responsible for transferring mail to servers or reporting failure.

How messages are presented and domain identifiers are determined is a local matter. 
Domains may be final or intermediate destinations. 
SMTP clients that forward all traffic blindly or do not maintain retry queues may conform to the spec 
but are not fully capable. 
Fully-capable SMTP implementations support queuing, retrying, and alternate address functions.

\section{Cluster of Re-Used Keys} 

The research paper titled \textit{“Cluster of Re-Used Keys”}\cite{cryptoeprint:2018/299}  surveys long-term cryptographic public keys used for TLS and SSH protocols across hosts in ten countries. The hosts examined were primarily those running SMTP, indicating an interest in measuring the security of email and related services. The primary finding is that key re-use is widespread across multiple IP addresses and even across different Autonomous Systems (ASes).

\subsection{Definition of a Cluster}
A \textbf{cluster} is defined as a set of IP addresses where each host shares at least one public key with another host in the same set.

\subsection{Key Re-Use Observations}

From a scan of 18{,}268 hosts in Ireland, approximately \textbf{53\%} of hosts running a cryptographic service were using public keys that were also observed on another IP address.  
Out of 54{,}447 host/port combinations running cryptographic protocols in the Irish scan, only \textbf{36\%} (20{,}053 entries) used unique keys—highlighting substantial key re-use.

The scan also identified a total of \textbf{1{,}437 clusters}, with the largest cluster containing \textbf{1{,}991 hosts}.

\subsection{Security Risks of Key Re-Use}

Key re-use introduces several undesirable security and privacy dependencies among cluster members:

\paragraph{Masquerade}
A breach on any one host allows an attacker to impersonate any other host within the same cluster.

\paragraph{Increased Leak Risk}
The probability of a private key leak increases significantly; compromise of one host exposes all other hosts sharing the same key.

\paragraph{Credential Capture}
An attacker masquerading as a legitimate service can capture sensitive credentials such as IMAP or SMTP passwords.

\paragraph{Web Origin Policy Breach}
If clustered hosts belong to different web origins, a compromise allows attackers to steal HTTP cookies, bypassing the browser's origin policy.

\subsection{Causes of Key Sharing}

Common reasons behind widespread key re-use include:

\begin{itemize}
    \item A single host being assigned multiple IP addresses
    \item Redundant mirrored hosts
    \item Cloned virtual machines containing pre-installed host keys
    \item Large-scale use of wildcard certificates
    \item Vendors shipping products with default key pairs
    \item Operational laziness or misconfiguration by service operators
\end{itemize}

\section{Cloud Platform Comparison for Internet-Scale Scanning}

\subsection{AWS and Azure Implementations}

\begin{center}
\begin{tabular}{|p{3cm}|p{6cm}|p{6cm}|}
\hline
\textbf{Component} & \textbf{AWS EC2 Implementation} & \textbf{Azure VM Implementation} \\
\hline

\textbf{Instance Type} &
Use network-optimized instances such as C-series (Compute Optimized) or M-series (General Purpose) with high network performance. C5n instances are ideal for network-intensive tasks. &
Use high-throughput instances such as the F-series (Compute Optimized) or Mv2-series (Memory Optimized), which provide high networking speeds. \\

\hline

\textbf{Operating System} &
A minimal Linux distribution (e.g., Ubuntu Server, Amazon Linux) is preferred. Scanning tools run optimally on Linux. &
Same: a minimal Linux distribution is recommended for compatibility and performance. \\

\hline

\textbf{Tool Installation} &
Install high-speed scanning tools like ZMap (for rapid port discovery) and ZGrab or \texttt{tls-scan} for application-layer handshakes and public key collection. &
Same toolchain: ZMap for SYN-ACK scanning, followed by ZGrab or \texttt{tls-scan} to perform TLS/SSH handshakes and extract certificates or host keys. \\

\hline
\end{tabular}
\end{center}
\section{ZMap Network Scanning Tool}

ZMap is a fast, stateless, single-packet network scanner designed for Internet-wide network surveys \cite{zmap2013}. On typical hardware, ZMap is capable of scanning the entire public IPv4 address space on a single port in under 45 minutes. For example, it can send a TCP SYN packet to every IPv4 address on port~25 to identify potential SMTP servers.

ZMap supports GNU/Linux, macOS, and BSD, and currently implements probe modules for TCP SYN scans, ICMP probes, and DNS queries.

\subsection{Performance and Limitations}

ZMap transmits packets as quickly as the host network interface allows. Since it intentionally does \textbf{not} implement congestion control, two main risks arise:

\paragraph{Target Network DoS}
Scanning a small subnet at an excessively high rate may unintentionally cause a denial-of-service (DoS). It is recommended not to run ZMap at speeds of 1~Gbps or higher when scanning small networks; instead, keep rates below 10~Mbps to avoid overwhelming the target.

\paragraph{Source Network Overload}
ZMap may also overload the source network. Some switches and routers cannot handle high-speed traffic consisting of many small packets.

ZMap scans in-scope IP addresses in a random order to reduce localized impact on target networks. The load experienced by a subnet depends on both the configured sending rate and the size of the target IP range.

Potential consequences of overloading a network include:
\begin{itemize}
    \item network administrators blocking the scanning IP address,
    \item routers silently dropping scan traffic,
    \item disruption of local users due to bandwidth starvation.
\end{itemize}

\subsection{Execution Model}

By default, ZMap uses four threads, unless the host machine has fewer than four CPU cores. The recommended number of threads for ZMap is:
\[
T_{\text{required}} = T + 2,
\]
where $T$ is the number of sending threads.

\subsection{Basic Usage}

To perform an initial scan that sends TCP SYN packets to all IP addresses in a subnet \texttt{xx.xx.xx.xx/xx} on port~80 at a send rate of 128~packets/s, use:

\begin{verbatim}
sudo zmap -p 80 -r 128 xx.xx.xx.xx/xx
\end{verbatim}

ZMap produces two types of output:
\begin{enumerate}
    \item a list of IP addresses that responded, and
    \item periodic scan status messages printed every second.
\end{enumerate}

To save scan results to a CSV file, use:

\begin{verbatim}
sudo zmap -p 80 -o output.csv -r 128 xx.xx.xx.xx/xx
\end{verbatim}

